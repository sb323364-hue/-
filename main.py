# Импортируем модуль cars под псевдонимом c
import cars as c

# Функция сортировки бинарными вставками
def sort_cars(data, key):
    # Создаем копию данных для сортировки
    result = data.copy()
    
    # Проходим по всем элементам, начиная со второго
    for i in range(1, len(result)):
        # Текущий автомобиль для вставки
        car = result[i]
        # Вычисляем ключ для текущего автомобиля
        k = key(car)
        # Границы для бинарного поиска
        left, right = 0, i-1
        
        # Бинарный поиск места для вставки
        while left <= right:
            # Находим середину диапазона
            mid = (left + right) // 2
            # Сравниваем ключи
            if k < key(result[mid]):
                # Ищем в левой половине
                right = mid - 1
            else:
                # Ищем в правой половине
                left = mid + 1
        
        # Сдвигаем элементы вправо, чтобы освободить место
        for j in range(i-1, left-1, -1):
            result[j+1] = result[j]
        
        # Вставляем автомобиль на найденную позицию
        result[left] = car
    
    # Возвращаем отсортированный список
    return result

# Загружаем данные из модуля cars
cars_data = c.data
# Выводим количество автомобилей в базе
print(f"Автомобилей в базе: {len(cars_data)}")

# Основной цикл программы
while True:
    # Выводим меню и получаем выбор пользователя
    choice = input("\n1. Все авто\n2. По марке\n3. По цене\n0. Выход\n> ")
    
    # Обработка выбора 1: показать все автомобили
    if choice == '1':
        # Выводим заголовок отчета
        print("\n" + "="*80)
        print("ВСЕ АВТОМОБИЛИ (год↓ цена↑)")
        print("="*80)
        # Сортируем и выводим все автомобили
        for i, car in enumerate(sort_cars(cars_data, lambda x: (-x['год'], x['цена'])), 1):
            # Форматированный вывод каждого автомобиля со всеми характеристиками
            print(f"{i:3}. {car['марка']:10} {car['модель']:15} | "
                  f"Год: {car['год']:4} | Кузов: {car['тип_кузова']:12} | "
                  f"Пробег: {car['пробег']:6,} км | Цена: {car['цена']:10,} руб.")
    
    # Обработка выбора 2: фильтр по марке
    elif choice == '2':
        # Получаем марку от пользователя
        brand = input("Марка: ").strip().lower()
        # Проверяем, что введена не пустая строка
        if brand:
            # Фильтруем автомобили по марке
            filtered = [car for car in cars_data if car['марка'].lower() == brand]
            # Проверяем, есть ли результаты
            if filtered:
                # Выводим заголовок отчета
                print("\n" + "="*80)
                print(f"{brand.upper()} (кузов↑ год↓ цена↑)")
                print("="*80)
                # Сортируем и выводим отфильтрованные автомобили
                for i, car in enumerate(sort_cars(filtered, lambda x: (x['тип_кузова'], -x['год'], x['цена'])), 1):
                    # Форматированный вывод каждого автомобиля со всеми характеристиками
                    print(f"{i:3}. {car['модель']:15} | "
                          f"Кузов: {car['тип_кузова']:12} | "
                          f"Год: {car['год']:4} | "
                          f"Цена: {car['цена']:10,} руб. | "
                          f"Пробег: {car['пробег']:6,} км")
            else:
                # Сообщение, если марка не найдена
                print("Марка не найдена")
    
    # Обработка выбора 3: фильтр по цене
    elif choice == '3':
        # Обработка возможных ошибок ввода
        try:
            # Получаем диапазон цен от пользователя
            min_price = int(input("Цена от: "))
            max_price = int(input("Цена до: "))
            
            if min_price > max_price:
                print("Ошибка: минимальная цена не может быть больше максимальной")
                continue
                
            # Фильтруем автомобили по цене
            filtered = [car for car in cars_data if min_price <= car['цена'] <= max_price]
            # Проверяем, есть ли результаты
            if filtered:
                # Выводим заголовок отчета
                print("\n" + "="*80)
                print(f"АВТОМОБИЛИ В ДИАПАЗОНЕ ЦЕН {min_price:,} - {max_price:,} руб. (цена↑ пробег↑)")
                print("="*80)
                # Сортируем и выводим отфильтрованные автомобили
                for i, car in enumerate(sort_cars(filtered, lambda x: (x['цена'], x['пробег'])), 1):
                    # Форматированный вывод каждого автомобиля со всеми характеристиками
                    print(f"{i:3}. {car['марка']:10} {car['модель']:15} | "
                          f"Цена: {car['цена']:10,} руб. | "
                          f"Пробег: {car['пробег']:6,} км | "
                          f"Год: {car['год']:4} | Кузов: {car['тип_кузова']:12}")
            else:
                # Сообщение, если автомобили не найдены
                print(f"Не найдено автомобилей в диапазоне {min_price:,} - {max_price:,} руб.")
        except ValueError:
            # Сообщение об ошибке ввода
            print("Ошибка ввода: введите целые числа для цены")
    
    # Обработка выбора 0: выход из программы
    elif choice == '0':
        # Сообщение о выходе
        print("Выход из программы")
        # Прерываем цикл
        break
    
    else:
        print('')
