# Импортируем модуль cars под псевдонимом c
import cars as c

# Функция сортировки бинарными вставками
def sort_cars(data, key):
    # Создаем копию данных для сортировки
    result = data.copy()
    
    # Проходим по всем элементам, начиная со второго
    for i in range(1, len(result)):
        # Текущий автомобиль для вставки
        car = result[i]
        # Вычисляем ключ для текущего автомобиля
        k = key(car)
        # Границы для бинарного поиска
        left, right = 0, i-1
        
        # Бинарный поиск места для вставки
        while left <= right:
            # Находим середину диапазона
            mid = (left + right) // 2
            # Сравниваем ключи
            if k < key(result[mid]):
                # Ищем в левой половине
                right = mid - 1
            else:
                # Ищем в правой половине
                left = mid + 1
        
        # Сдвигаем элементы вправо, чтобы освободить место
        for j in range(i-1, left-1, -1):
            result[j+1] = result[j]
        
        # Вставляем автомобиль на найденную позицию
        result[left] = car
    
    # Возвращаем отсортированный список
    return result

# Загружаем данные из модуля cars
cars_data = c.data
# Выводим количество автомобилей в базе
print(f"Автомобилей в базе: {len(cars_data)}")

# Основной цикл программы
while True:
    # Выводим меню и получаем выбор пользователя
    choice = input("\n1. Все авто\n2. По марке\n3. По цене\n0. Выход\n> ")
    
    # Обработка выбора 1: показать все автомобили
    if choice == '1':
        # Выводим заголовок отчета
        print("\nВсе автомобили (год↓ цена↑):")
        # Сортируем и выводим все автомобили
        for car in sort_cars(cars_data, lambda x: (-x['год'], x['цена'])):
            # Форматированный вывод каждого автомобиля
            print(f"  {car['марка']} {car['модель']} - {car['год']}г ({car['цена']:,}р)")
    
    # Обработка выбора 2: фильтр по марке
    elif choice == '2':
        # Получаем марку от пользователя
        brand = input("Марка: ").strip().lower()
        # Проверяем, что введена не пустая строка
        if brand:
            # Фильтруем автомобили по марке
            filtered = [car for car in cars_data if car['марка'].lower() == brand]
            # Проверяем, есть ли результаты
            if filtered:
                # Выводим заголовок отчета
                print(f"\n{brand.upper()} (кузов↑ год↓ цена↑):")
                # Сортируем и выводим отфильтрованные автомобили
                for car in sort_cars(filtered, lambda x: (x['тип_кузова'], -x['год'], x['цена'])):
                    # Форматированный вывод каждого автомобиля
                    print(f"  {car['модель']} | {car['тип_кузова']} | {car['год']}г | {car['цена']:,}р")
            else:
                # Сообщение, если марка не найдена
                print("Марка не найдена")
    
    # Обработка выбора 3: фильтр по цене
    elif choice == '3':
        # Обработка возможных ошибок ввода
        try:
            # Получаем диапазон цен от пользователя
            min_price = int(input("Цена от: "))
            max_price = int(input("Цена до: "))
            # Фильтруем автомобили по цене
            filtered = [car for car in cars_data if min_price <= car['цена'] <= max_price]
            # Проверяем, есть ли результаты
            if filtered:
                # Выводим заголовок отчета
                print(f"\nЦена {min_price:,}-{max_price:,}р (цена↑ пробег↑):")
                # Сортируем и выводим отфильтрованные автомобили
                for car in sort_cars(filtered, lambda x: (x['цена'], x['пробег'])):
                    # Форматированный вывод каждого автомобиля
                    print(f"  {car['марка']} {car['модель']} - {car['цена']:,}р ({car['пробег']}км)")
            else:
                # Сообщение, если автомобили не найдены
                print("Не найдено")
        except:
            # Сообщение об ошибке ввода
            print("Ошибка ввода")
    
    # Обработка выбора 0: выход из программы
    elif choice == '0':
        # Сообщение о выходе
        print("Выход")
        # Прерываем цикл
        break